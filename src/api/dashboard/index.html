<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title>astrometry-api-lite dashboard</title>
		<link href="bootstrap.min.css" rel="stylesheet">
		<script src="jquery.js"></script>
		<script src="bootstrap.bundle.min.js"></script>
		<script src="vue.js"></script>
		<script src="axios.js"></script>
		
		<style>

			h3 {
				margin-bottom: 1rem;
			}
			.jobtable {
				width: 100%;
			}

			.detailtable {
				width: 100%;
			}

			.detailtable > tbody > tr > td:nth-child(1) {
				border-left: 0.5em solid #ccc;
				width: 6%;
			}

			.detailtable > tbody > tr > td:nth-child(2) {
				width: 94%;
			}

			.jobtable td {
				padding: 0.5em 1em 0.5em 0em;
				
			}

			.jobtable td:nth-child(1).jobcell {
				padding: 0;
				width: 100%;
			}

			.jobtable td:nth-child(1), th:nth-child(1) {
				padding-left: 0.25em;
				width: 6%;
			}
			.jobtable td:nth-child(2), th:nth-child(2) {
				width: 20%;
			}
			.jobtable td:nth-child(3), th:nth-child(3) {
				width: 20%;
			}
			.jobtable td:nth-child(4), th:nth-child(4) {
				width: 20%;
			}
			.jobtable td:nth-child(5), th:nth-child(5) {
				width: 20%;
			}
			.jobtable td:nth-child(6), th:nth-child(6) {
				width: 14%;
			}


			.jobtable tr:nth-child(even) {
				background: #fafafa;
			}

			.jobtable tr:nth-child(odd) {
				background: #fff;
			}
			.jobtable thead {
				border-bottom: 1px solid #ccc;
			}

			.jobtable th {
				padding: 0.5em 1em 0.5em 0em;
			}

			.show-details, .hide-details {
				width: 1em;
				height: 1em;
				display: block;
				background: url(arrowdown.png) center center no-repeat;
				background-size: contain;
			}

			.hide-details {
				transform: rotate(180deg);
			}

			.job-details {
				margin-left: -0.25em;
			}

			.detail-container {
				display: inline-block;
				padding-right: 3em;
				width: 13em;
				padding-bottom: 0.5em;
			}

			.result-numbers {
				display: inline-block;
				width: 43%;
			}

			.result-images {
				display: inline-block;
				width: 50%;
				vertical-align: top;
			}

			.result-img {
				display: inline-block;
			}

			.datetd {
				min-width: 150px;
			}

			.resultThumb {
				cursor: pointer;
				width: 13em;
				margin-bottom: 1em;
			}

			.s-queued {
				color: cadetblue;
				font-weight: bold;
			}
			.s-processing {
				color: yellowgreen;
				font-weight: bold;
			}
			.s-success {
				color: forestgreen;
				font-weight: bold;
			}
			.s-failed {
				color: firebrick;
				font-weight: bold;
			}
		</style>
	</head>
	<body>
		<div id="app">
			<div class="modal fade" tabindex="-1" role="dialog" id="thumbModal">
				<div class="modal-dialog modal-lg" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Image</h5>
							<button type="button" class="close" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<img :src="downloadedImage" style="width: 100%">
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>
			<div class="container">
				<h1>Astrometry-api-lite</h1>
				<hr/>
			</div>
			<div class="container">
					<br/>
				<h3>Status</h3>
				<table>
					<tr>
						<td style="min-width:150px">Manager:</td>
						<td>
							<b style="color:green" v-if="status.workerManagerRunning">RUNNING</b>
							<b style="color:red" v-else>DOWN</b>
						</td>
					</tr>
					<tr>
						<td>Workers active:</td><td>{{status.activeWorkers.length}}</td>
					</tr>
				</table>
				<hr/>
			</div>
			<div class="container">
					<br/>
				<h3>Latest jobs</h3>
				<table class="jobtable">
					<thead>
						<th>Id</th>
						<th>Created</th>
						<th>State</th>
						<th>Started</th>
						<th>Ended</th>
						<th></th>
						<!-- <th>Duration</th>
						<th>Orientation</th>
						<th>Pixscale</th>
						<th>Radius</th>
						<th>Ra</th>
						<th>Dec</th>
						<th>Objects</th>
						<th>Annotated</th> -->
					</thead>
					<tbody>
						<!-- <div v-for="job in latestJobs"> -->
						<tr v-for="job in latestJobs">
							<td colspan="6" class="jobcell">
								<div class="list-cell">
									<table class="jobtable">
										<tr>
											<td>{{job.id}}</td>
											<td>{{makeDate(job.created)}}</td>
											<td>
												<span v-if="job.processing_state == 0" class="s-queued">QUEUED <span style="cursor:pointer" v-if="supports.jobCancellationSupported" v-on:click="cancelJob(job)">&#x274C;</span></span>
												<span v-if="job.processing_state == 1" class="s-processing">PROCESSING <span style="cursor:pointer" v-if="supports.jobCancellationSupported" v-on:click="cancelJob(job)">&#x274C;</span></span>
												<span v-if="job.processing_state == 2" class="s-success">SUCCESS</span>
												<span v-if="job.processing_state == 3" class="s-failed">FAILED</span>
											</td>
											<td>{{makeDate(job.processing_started)}}</td>
											<td>{{makeDate(job.processing_finished)}}</td>
											<td><button type="button" class="btn" v-on:click="toggleDetails(job)">
												<span v-if="!isOpen(job)" class="show-details"></span>
												<span v-if="isOpen(job)" class="hide-details"></span>
											</button></td>
										</tr>
									</table>
									<table class="detailtable" v-if="isOpen(job)">
										<tr>
											<td></td>
											<td>
												<div class="job-details">
													<div class="result-numbers">
														<div class="detail-container">
															<b>Duration</b><br/>
															{{job.processing_finished && job.processing_started ? makeTimespan(job.processing_finished - job.processing_started) : '-'}}
														</div>
														<div class="detail-container">
															<b>Orientation</b><br/>
															{{job.processing_state == 2 ? job.result_orientation : '-'}}
														</div>
														<div class="detail-container">
															<b>Pixscale</b><br/>
															{{job.processing_state == 2 ? job.result_pixscale : '-'}}
														</div>
														<div class="detail-container">
															<b>Radius</b><br/>
															{{job.processing_state == 2 ? job.result_radius : '-'}}
														</div>
														<div class="detail-container">
															<b>Ra</b><br/>
															{{job.processing_state == 2 ? job.result_ra : '-'}}
														</div>
														<div class="detail-container">
															<b>Dec</b><br/>
															{{job.processing_state == 2 ? job.result_dec : '-'}}
														</div>
													</div><div class="result-images">
														<div v-if="job.img_objs_thumb" class="result-img">
															<a v-on:click="triggerThumbModal(job.id, 'objs')">
																<img :src="job.img_objs_thumb" class="resultThumb">
															</a>
														</div>
														<div v-if="job.img_ngc_thumb" class="result-img">
															<a v-on:click="triggerThumbModal(job.id, 'ngc')">
																<img :src="job.img_ngc_thumb" class="resultThumb">
															</a>
														</div>
													</div>
												</div>
											</td>
										</tr>
									</table>
									
								</div>
							</td>
							<!-- <td>{{job.id}}</td>
							<td class="datetd">{{makeDate(job.created)}}</td>
							<td style="min-width:9em">
								<span v-if="job.processing_state == 0" class="s-queued">QUEUED <span style="cursor:pointer" v-if="supports.jobCancellationSupported" v-on:click="cancelJob(job)">&#x274C;</span></span>
								<span v-if="job.processing_state == 1" class="s-processing">PROCESSING <span style="cursor:pointer" v-if="supports.jobCancellationSupported" v-on:click="cancelJob(job)">&#x274C;</span></span>
								<span v-if="job.processing_state == 2" class="s-success">SUCCESS</span>
								<span v-if="job.processing_state == 3" class="s-failed">FAILED</span>
							</td>
							<td class="datetd">{{makeDate(job.processing_started)}}</td>
							<td class="datetd">{{makeDate(job.processing_finished)}}</td>
							<td>{{job.processing_finished && job.processing_started ? makeTimespan(job.processing_finished - job.processing_started) : '-'}}</td>
							<td>{{job.processing_state == 2 ? job.result_orientation : '-'}}</td>
							<td>{{job.processing_state == 2 ? job.result_pixscale : '-'}}</td>
							<td>{{job.processing_state == 2 ? job.result_radius : '-'}}</td>
							<td>{{job.processing_state == 2 ? job.result_ra : '-'}}</td>
							<td>{{job.processing_state == 2 ? job.result_dec : '-'}}</td>
							<td>
								<div v-if="job.img_objs_thumb">
									<a v-on:click="triggerThumbModal(job.id, 'objs')">
										<img :src="job.img_objs_thumb" class="resultThumb">
									</a>
								</div>
							</td>
							<td>
								<div v-if="job.img_ngc_thumb">
									<a v-on:click="triggerThumbModal(job.id, 'ngc')">
										<img :src="job.img_ngc_thumb" class="resultThumb">
									</a>
								</div>
							</td>
						</tr> -->
						<!-- </div> -->
					</tbody>
				</table>
			</div>
		</div>
		<script src="main.js"></script>
	</body>
</html>